<!DOCTYPE html>

<html>
  <head>
    <!-- Google Tag Manager -->
      <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-NPJGLPK');</script>
    <!-- End Google Tag Manager -->
    <link type="text/css" rel="stylesheet" href="rCzyrnik.css"/>
    <title> Making A Spectroscope </title>
  </head>

 <body>
  <!-- Google Tag Manager (noscript) -->
      <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NPJGLPK"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

<!--/*><><><><><><><><><><><><>  NAVBAR  <><><><><><><><><><><*/-->
<div class="navbar">
  <div id="my_name"><a href="index.html">Rebecca Czyrnik</div></a>
  <a href="proj_analysis.html"><div class="page_name"><br/>Acme Co</div></a>
  <a href="proj_userengagement.html"><div class="page_name"><br/>User Engagement</div></a>
  <a href="proj_priceprediction.html"><div class="page_name"><br/>Price Prediction</div></a>
  <a href="fun_doggames.html"><div class="page_name"><br/>Games For Dogs</div></a>
  <a href="fun_calculators.html"><div class="page_name"><br/>Calculators</div></a>
  <a href="fun_camera.html"><div class="page_name"><br/>Camera</div></a>
  <a href="fun_spectroscope.html"><div class="page_name" id='current_page'><br/>Spectroscope</div></a>
  <a href="fun_shortprojects.html"><div class="page_name"><br/>Short Projects</div></a>
</div> <!-- Closes navbar -->


   <!--/*><><><><><><><><><><><><>  LINK BOX  <><><><><><><><><><><*/-->
   <div class="link_box">
       <p><a href="https://github.com/rczyrnik/iPhoneSpectroscope">Spectroscope<br/>Github Link</a></p>
   </div>

<!-- /*><><><><><><><><><><><><>  CONTENT  <><><><><><><><><><><*/ -->
<div class="main_content">

<div class="FAQBox">
  <h3> What is the goal of this project? </h3>
  <p class='FAQ'>
  Use my phone's camera to identify a gas based on its spectrum.
  </p>

  <h3> Context </h3>
  <p class='FAQ'>
   This project evoleved from a discussion about telescopes I had with my students after the
   April 2016 transit. For more details, look <a href = "fun_backstory.html" style="color:red"> here </a> .
  </p>

  <h3> What tools did I use? </h3>
  <p class='FAQ'>
    A diffraction grating and poster board for the camera attachment, python
    for the coding.
</p>
</div>
<br/><br/>
    <h2> Introduction </h2>
    <p>
      Our cellphone cameras capture images using technology
      very similar to that found in space telescopes.
      This journey began with an attempt to plot the black body
      radiation from our sun and will hopefully end with a
      program that identifies a gas based on its spectral lines.
    </p>

    <p> A spectroscope breaks apart the light from an object into separate wavelengths.
      Because different objects have unique spectral "fingerprints", knowing what
      wavelengths of light come from that object can teach is about the object.
      For example, astronomers use the spectra of distant stars and galaxies to
      determine what they are made of and how fast and in what direction they are
       moving.</p>

    <p> In the spring of 2016 I was fortunate enought to observe a ten-or-so-times
      per lifetime transit of Mercury. While sharing the event with my physics
      classes (Click <a href = "fun_backstory.html" style="color:red"> here </a>
      for the backstory) I started to wonder if I could use my own smartphone camera
      to build a spectroscope. Afterall, the cameras that astronomers use to capture
      pictures of the sky are built with the same technology as the cameras in our
      smartphones.</p>

<br/><br/>
    <h2> Steps </h2>
    <ol>
        <li> <a href = "#build">Build the phone attachment</a></li>
        <li> <a href = "#picture">Take the picture</a></li>
        <li> Straighten the curve (Not an actual step. Click <a class="nav" href="fun_straighten.html" style="color:red">here</a> for an interesting sidetrack)</a></li>
        <li> <a href = "#histogram">Make a histogram </a></li>
        <li> <a href = "#lasers">Calibrate the data </a></li>

    </ol>


<br/><br/>
<h2 id="build"> Step 1: Build the Phone Attachment </h2>
    <p> I based my design off the example from MIT Open Courses, and modified it to fit my phone. </p>
    <p> I found an ugly magenta phone case in a bargin bin for $3. With a bit of (unnecessary) spray paint, I converted it to a more reasonable and boring black. </p>
    <p> I cut up a small piece of difraction grating, found in my classroom but also avaible online for cheap. Or you could do what MIT recommends and cut up a CD, although if you're like me you would have to go out a buy a CD to cut up. Where's AOL when we need them? </p>
    <p> I shortened the tube until I could see the full spectrum as large as possible, around 2 cm long, I think. In one model (found here), the tube was bent to the side to capture the rainbow from just one side of the slit, but I thought it might be nice to have two sides to get twice as much data. (Just kidding, I was too lazy to make a slanted cut). </p>
    <p> The final spectroscope looked like this: </p>
    <img class="displayed" src="spectroscope/Spectroscope.JPG">


<br/><br/>
<h2 id="picture"> Step 2: Take the Picture </h2>
        <p> I have a massive advantage as a physics teacher, because I have
        access to the glowing tubes we use when investigating the
        electromagnetic spectrum. </p>
        <p> Surprisingly, the trickiest part of this part of this adventure
        was finding a program to take pictures without compression. </p>
        <p> "Oh no!" the internet says. "Nowadays compression algorithms are
        so good that there is pratically no loss of information. There's no
        reason you could ever want to deal with uncompressed data", they
        say.</p>
        <p> What they haven't considered is you might be a physics teacher
        with a passing interest in astronomy and a desire to build your own
        optical instruments. </p>
        <p> (Internet people thinking they know what you want grumble
        grumble grumble multinational corporations cough cough apple cough
        cough removing features from the default camera app grumble grumble
        grumble) </p>
        <p> Anyway, I eventually found a free app that would let me save my
        pictures as tif files. </p>
        <p> Here's what the raw data looked like: </p>
        <img class="displayed" src="spectroscope/1_OriginalTiffFile.png">

<br/><br/>
<h2 id="histogram"> Step 4: Make a Histogram </h2>


        <p> There are a few steps to get from the raw data to a histogram </p>


        <h3> Read in the data </h3>
        <p> To read in the data I used a python module called "Pillow" </p>
        <div><pre><code>
        from PIL import Image

        def readImage(element):
            tiff = "tif/Element" + str(element)  + ".tif"
            img = Image.open(tiff)
            return img
        </code></pre></div>

        <p> At this point the data just looks like the original picture: </p>
        <img class="displayed" src="spectroscope/1_OriginalTiffFile.png">

        <h3> Crop the image and convert to grayscale </h3>

        <p> You probably noticed that the image was curved. My first though was to straighten out the curve, assuming the shape was a parabola. This was a lot of fun to do, but ultimately resulted in data that was not as nice as if I just ignored the curve and cropped from the middle. </p>
        <div><pre><code>
        def cropImage(img, CropHeight):
            width, height = img.size
            box = (0, height/2-CropHeight/2, width, height/2+CropHeight/2)
            img = img.crop(box).convert('L')
            return imgage
        </code></pre></div>
        <img class="displayed" src="spectroscope/2_CroppedAndGrayscale.png">


        <h3> Flatten the image </h3>
        <p> The goal here was to turn my two dimensional array into a single dimension of data. I did this by summing up all the data in each row (see image). </p>
        <img src="spectroscope/Step2.png" width=500px>
        <div><pre><code>
        def flattenImage(img):
            w, h = img.size
            data = []
            for x in range(w):
                value = 0
                for  y in range(h):
                value = value + img.getpixel((x,y))
                data = data + [value]
            return data
        </code></pre></div>
        <p> The result was a long string of numbers, of which I've shown 360 or so below. Real exciting, right? </p>
        <img src="spectroscope/3_Numbers.png" width=500px>
            <p> A better way to view the data is probably in a graph, with pixel position on the x-axis and brightness on the y. The results look like this: </p>
            <img src="spectroscope/3_Flattened.png" width=500px>

        <h3> Find the center </h3>
        <p> The data shows a bright line down the center flanked by to roughly symmetrical sets of data. That vertical central band should be in the center of the photo, but no guarentees. It'd be better to find the center ourselves. </p>

        <p> I did this by first finding the maximum value of the data set. Because the central band could have been lopsided, I then found the points two thirds from the top to the left and right, and took the average of their positions. </p>

        <div><code><pre>
        def findCenter(data):
            maximum = 0    # maximum value
            maximum_x = 0  # x position of maximum value

            for x in range(0, len(data)):
                if data[x] > maximum:
                maximum = data[x]
                maximum_x = x

            twothirds = maximum * .6667
            bottom = maximum_x
            top = maximum_x

            while data[bottom] > twothirds:
                bottom = bottom - 1
            while data[top] > twothirds:
                top = top + 1

            return int((bottom + top)/2)
        </code></pre></div>

        <h3> Crop the data to visible wavelengths </h3>
        <p> Now that we have the center, we can crop out only the part of the picture containing visible light. I could have used the data to the left or the right, but I chose the data to the right. Roughly speaking, the visible wavelengths begin about 500 pixels from the central bright line, and end about 1500 pixels from it. </p>

        <img src="spectroscope/4_Cropped.png" width=500px>
        <div><pre><code>
        def cropData(data, center, start, end):
            start = center+start
            end = center+end
            data = data[start:end]
            return data
        </code></pre></div>


        <h3> Smooth out the data to reduce noise </h3>
        <img src="spectroscope/5_Smoothed.png" width=500px>

        <div><pre><code>
        def smoothData(data, times):
            for i in range(0, times):
                smooth_data = []
                for x in range(0, len(data)-1):
                    smooth_data = smooth_data + [(data[x-1]+2*data[x]+data[x+1])/4]
                data = smooth_data
            return data
        </code></pre></div>


        <h3> Find the peaks </h3>

        <div><pre><code>
        def findPeaks(data):
            peakPosition = []
            peakHeight = []
            avg = sum(data)/len(data)
            for x in range(1, len(data)-1):
                    if data[x-1] < data [x] and data[x+1] < data[x] and
                    data[x] > avg:
                    peakHeight = peakHeight+[data[x]]
                    peakPosition = peakPosition+[x]
            return (peakPosition,peakHeight)


        </code></pre></div>

<h2 id="calibrate"> Step 5: Calibrate the Data </h2>
        <h4 id="lasers"> Convert Pixel Positon to Wavelength </h4>

        <p> <em>(Code exists, but the explanation is still in progress) </em></p>


    </div>
    </div>
    </body>
